<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
    <link rel="icon" type="image/png" href="/static/images/FAVICON.png" />
 
    <link rel="stylesheet" href="/static/css/adminRequests.css" />
   
    <script src="/static/js/index.js" defer></script>
    
    <title>Medlorix │ Admin Dashboard Requests</title>
  </head>

  <body>
    <header>
      <a href="/"
        ><img
          class="brand-logo"
          src="/static/images/Medlorix-logo.svg"
          alt="Medlorix logo"
      /></a>
      <div class="search">
        <input type="search" placeholder="Search" class="custom-dropdown">
      </div>
      <div class="admin">
        <div class="admin-box">
          <img src="/static/images/AdminPage/Image User 1.png" alt="" class="profile-pic">
          <div class="profile-name">
            <h3>Mogaji Bolaji</h3>
            <p>Admin</p>
          </div>
        </div>
        <div class="notifications">
          <img src="/static/images/AdminPage/NotificationVector.png" alt="" class="img-tools">
        </div>
        <div class="settings">
          <img src="/static/images/AdminPage/SettingsVector.png" alt="" class="img-tools">
        </div>
      </div>
    </header>

    
    <nav>
      <a href="/admin-appointment" class="p-appointment">
        <img src="/static/images/AdminPage/Vector.png" alt="">
        <p >Appointments</p>
      </a>
      <a href="/admin-Requests" class="r-request">
        <img src="/static/images/AdminPage/rq-img.png" alt="">
        <p>Requests</p>
      </a>
      <a href="/admin-doctors">
        <img src="/static/images/AdminPage/fontisto_doctor.png" alt="">
        <p>Doctors</p>
      </a>
      <a href="/admin-patients">
        <img src="/static/images/AdminPage/mdi_users.png" alt="">
        <p>Patients</p>
      </a>
    </nav>
  
    <section id="hero">
        <div id="appointment-requests">
          <div class="top-div">
            <h1>List of Requests</h1>
          </div>
          <div class="table">
            <table>
              <thead>
                  <tr>
                    <th>USERNAME</th>
                    <th>ID</th>
                    <th>DOCUMENT</th>
                    <th>REQUEST DATE</th>
                    <th>STATUS</th>
                    <th>ACTION</th>
                  </tr>
              </thead>

                <tbody>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="pending">Pending</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="approved">Approved</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="declined">Declined</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="pending">Pending</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="approved">Approved</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="declined">Declined</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                    <tr>
                        <td>
                        <div class="parent-div">
                            <div class="child-div1">
                                <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                            </div>
                            <div class="child-div2">
                            <h3>Dr. Mogaji Bolaji</h3>
                            </div>
                        </div>
                        </td>
                        <td>12345678</td>
                        <td><img src="/static/images/AdminPage/pdf.png" class="pdf"></td>
                        <td>01/10/2024</td>
                        <td><p class="pending">Pending</td>
                        <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                    </tr>
                </tbody>
            </table>
          </div>
          <div class="button-div">
            <button>View More</button>
          </div>
        </div>
    </section>
    
 
    <footer>
      <div class="lastlayer">
        <p class="copyright">
          Copyright &copy; 2024. Medlorix. All rights reserved
        </p>
        <div>
          <a href="/terms"><p>Terms and Conditions</p></a>
          <a href="/terms"><p>Privacy Policy</p></a>
        </div>
      </div>
    </footer>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          displayApplications();
      });
  
      function displayApplications() {
          const storedData = localStorage.getItem('doctorApplicationData');
          if (storedData) {
              const application = JSON.parse(storedData);
              const tableBody = document.querySelector('#requestsTable tbody');
              tableBody.innerHTML = ''; 
  
              const row = createTableRow(application);
              tableBody.appendChild(row);
          } else {
              console.log('No application data found in localStorage');
          }
      }
  
      function createTableRow(application) {
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>
                  <div class="parent-div">
                      <div class="child-div1">
                          <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                      </div>
                      <div class="child-div2">
                          <h3>Dr. ${application.firstname} ${application.lastname}</h3>
                      </div>
                  </div>
              </td>
              <td>${generateRandomId()}</td>
              <td><img src="/static/images/AdminPage/pdf.png"></td>
              <td>${new Date().toLocaleDateString()}</td>
              <td><p class="pending">Pending</p></td>
              <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
          `;
          return row;
      }
  
      function generateRandomId() {
          return Math.floor(10000000 + Math.random() * 90000000).toString();
      }
      </script>
  </body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/images/FAVICON.png" />
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/static/css/adminRequests.css" />
    <!-- JavaScript -->
    <script src="/static/js/index.js" defer></script>
    <title>Medlorix │ Admin Dashboard Requests</title>
</head>

<body>
    <header>
        <a href="/">
            <img class="brand-logo" src="/static/images/Medlorix-logo.svg" alt="Medlorix logo" />
        </a>
        <div class="search">
            <input type="search" placeholder="Search" class="custom-dropdown">
        </div>
        <div class="admin">
            <div class="admin-box">
                <img src="/static/images/AdminPage/Image User 1.png" alt="" class="profile-pic">
                <div class="profile-name">
                    <h3>Mogaji Bolaji</h3>
                    <p>Admin</p>
                </div>
            </div>
            <div class="notifications">
                <img src="/static/images/AdminPage/NotificationVector.png" alt="" class="img-tools">
            </div>
            <div class="settings">
                <img src="/static/images/AdminPage/SettingsVector.png" alt="" class="img-tools">
            </div>
        </div>
    </header>

    <!-- Navigation Section -->
    <nav>
        <a href="/admin-appointment" class="p-appointment">
            <img src="/static/images/AdminPage/Vector.png" alt="">
            <p>Appointments</p>
        </a>
        <a href="/admin-Requests" class="r-request">
            <img src="/static/images/AdminPage/rq-img.png" alt="">
            <p>Requests</p>
        </a>
        <a href="/admin-doctors">
            <img src="/static/images/AdminPage/fontisto_doctor.png" alt="">
            <p>Doctors</p>
        </a>
        <a href="/admin-patients">
            <img src="/static/images/AdminPage/mdi_users.png" alt="">
            <p>Patients</p>
        </a>
    </nav>

    <!-- Hero Section -->
    <!-- <section id="hero">
        <div id="appointment-requests">
            <div class="top-div">
                <h1>List of Requests</h1>
            </div>
            <div class="table">
                <table id="requestsTable">
                    <thead>
                        <tr>
                            <th>USERNAME</th>
                            <th>ID</th>
                            <th>DOCUMENT</th>
                            <th>REQUEST DATE</th>
                            <th>STATUS</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody>g
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="pending">Pending</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="approved">Approved</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="declined">Declined</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="pending">Pending</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="approved">Approved</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="declined">Declined</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                        <tr>
                            <td>
                            <div class="parent-div">
                                <div class="child-div1">
                                    <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                                </div>
                                <div class="child-div2">
                                <h3>Dr. Mogaji Bolaji</h3>
                                </div>
                            </div>
                            </td>
                            <td>12345678</td>
                            <td><img src="/static/images/AdminPage/pdf.png"></td>
                            <td>01/10/2024</td>
                            <td><p class="pending">Pending</td>
                            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
                        </tr>
                  
                    </tbody>
                </table>
                <a href="">
                    <button class="btn">VIEW MORE</button>
                </a>
            </div>
        </div>
    </section> -->
    
    <section id="hero">
        <div id="appointment-requests">
            <div class="top-div">
                <h1>List of Doctor Requests</h1>
            </div>
            <div class="table">
                <table id="requestsTable">
                    <thead>
                        <tr>
                            <th>NAME</th>
                            <th>ID</th>
                            <th>DOCUMENT</th>
                            <th>DOCUMENT</th>
                            <th>STATUS</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table body will be populated by JavaScript -->
                    </tbody>
                </table>
                <a href="">
                    <button class="btn">VIEW MORE</button>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer>
        <div class="lastlayer">
            <p class="copyright">
                Copyright &copy; 2024. Medlorix. All rights reserved
            </p>
            <div>
                <a href="/terms"><p>Terms and Conditions</p></a>
                <a href="/privacy"><p>Privacy Policy</p></a>
            </div>
        </div>
    </footer>
    <!-- <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetchDoctorApplications();
        });

        async function fetchDoctorApplications() {
            try {
                const response = await fetch('/admin-Requests-page');
                const applications = await response.json();
                const tableBody = document.querySelector('#requestsTable tbody');
                tableBody.innerHTML = ''; 

                applications.forEach(app => {
                    const row = createTableRow(app);
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching doctor applications:', error);
            }
        }

        function createTableRow(app) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <div class="parent-div">
                        <div class="child-div1">
                            <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                        </div>
                        <div class="child-div2">
                            <h3>Dr. ${app.firstname} ${app.lastname}</h3>
                        </div>
                    </div>
                </td>
                <td>${app.display_id}</td>
                <td>
                ${app.cv_url 
                    ? `<a href="${app.cv_url}" target="_blank"><img src="/static/images/AdminPage/pdf.png" alt="CV" title="Click to view CV"></a>`
                    : '<img src="/static/images/AdminPage/pdf.png" alt="No CV" title="No CV uploaded">'
                }
                </td>
                <td>${new Date(app.created_at).toLocaleDateString()}</td>

                <td><p class="pending">Pending</p></td>
                <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
            `;
            return row;
        }
    </script>
</body>
</html> -->


<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetchDoctorApplications();
    });

    async function fetchDoctorApplications() {
        try {
            const response = await fetch('/admin-Requests-page');
            const applications = await response.json();
            const tableBody = document.querySelector('#requestsTable tbody');
            tableBody.innerHTML = ''; 

            applications.forEach(app => {
                const row = createTableRow(app);
                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching doctor applications:', error);
        }
    }

    function createTableRow(app) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <div class="parent-div">
                    <div class="child-div1">
                        <img src="/static/images/AdminPage/Ellipse 95.png" alt="" class="profile-pic">
                    </div>
                    <div class="child-div2">
                        <h3>Dr. ${app.firstname} ${app.lastname}</h3>
                    </div>
                </div>
            </td>
            <td>${app.display_id}</td>
            <td>
            ${app.cv_url 
                ? `<a href="${app.cv_url}" target="_blank"><img src="/static/images/AdminPage/pdf.png" alt="CV" title="Click to view CV"></a>`
                : '<img src="/static/images/AdminPage/pdf.png" alt="No CV" title="No CV uploaded">'
            }
            </td>
            <td>${new Date(app.created_at).toLocaleDateString()}</td>
            <td><select class="status-select" data-id="${app.id}">
                <option value="pending" ${app.status === 'pending' ? 'selected' : ''}>Pending</option>
                <option value="approved" ${app.status === 'approved' ? 'selected' : ''}>Approved</option>
            </select></td>
            <td class="dot"><img src="/static/images/AdminPage/dot.png"></td>
        `;

        const statusSelect = row.querySelector('.status-select');
        statusSelect.addEventListener('change', function() {
            updateStatus(app.id, this.value);
        });

        return row;
    }

    async function updateStatus(id, status) {
        try {
            const response = await fetch('/update_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id, status }),
            });

            if (!response.ok) {
                throw new Error('Failed to update status');
            }

            if (status === 'approved') {
                sendToBookAppointment2(id);
            }
        } catch (error) {
            console.error('Error updating status:', error);
        }
    }

    async function sendToBookAppointment2(id) {
    try {
        const response = await fetch('/bookAppointment', {
            method: 'GET',
        });

        if (!response.ok) {
            throw new Error('Failed to fetch appointment details');
        }

        const doctors = await response.json();

        // Check if the doctor is in the approved list
        const doctor = doctors.find(d => d.id === id);
        if (doctor) {
            console.log('Doctor approved:', doctor);
            // Proceed with booking logic
        } else {
            console.error('Doctor is not approved yet');
        }
    } catch (error) {
        console.error('Error sending to book appointment:', error);
    }
}

    // async function sendToBookAppointment2(id) {
    //     try {
    //         const response = await fetch('/bookAppointment2', {
    //             method: 'POST',
    //             headers: {
    //                 'Content-Type': 'application/json',
    //             },
    //             body: JSON.stringify({ id }),
    //         });

    //         if (!response.ok) {
    //             throw new Error('Failed to send details to bookAppointment2');
    //         }

    //         console.log('Details sent to bookAppointment2 successfully');
    //     } catch (error) {
    //         console.error('Error sending details to bookAppointment2:', error);
    //     }
    // }
</script>
</body>
</html>


